/**
 * Created by Sam on 18/05/15.
 */
var mysql      = require('mysql');
var connection = mysql.createConnection({
    host     : 'localhost',
    user     : 'root',
    password : '',
    database : 'gates'
});

var status = {
    AUTHENTICATED: 'authenticated',
    DISCONNECTED: 'disconnected'
}

function connect(callback) {
    connection.connect(callback);
}


function isConnected() {
    if (connection) {
        return connection.state === status.AUTHENTICATED;
    }
}


connection.on('close', connect);
connection.on('error', onError);

function onError(err) {
    // Probably all wrong
    connect();
}




function attemptQuery(queryString, callback) {



    if (isConnected()) {
        executeQuery(queryString);
    } else {
        // if not connected, attempt to connect, with the callback to executeQuery (i.e. executeQuery will be called when the DB is connected
        connect(function(){executeQuery(queryString);});
    }


    function executeQuery(queryString) {
        function onResponse(err, row, fields) {
            if (!err) {
                callback(201);
            } else {
                callback(500);
            }
        }
        connection.query(queryString, onResponse);


    }



}

exports.attemptQuery = attemptQuery;

//connection.end();